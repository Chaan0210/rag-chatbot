.chat-layout {
  height: 100dvh;
  min-height: 100dvh;
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  overflow: hidden;
  background:
    radial-gradient(
      circle at top left,
      rgba(251, 219, 170, 0.45),
      transparent 48%
    ),
    radial-gradient(
      circle at top right,
      rgba(177, 227, 241, 0.4),
      transparent 42%
    ),
    #f8f6f1;
  color: #1f2d3d;
}

.chat-layout.has-sidebar {
  grid-template-columns: 340px minmax(0, 1fr);
}

.chat-layout.has-reference {
  grid-template-columns: minmax(0, 1fr) 340px;
}

.chat-layout.has-sidebar.has-reference {
  grid-template-columns: 340px minmax(0, 1fr) 340px;
}

.sidebar-backdrop {
  display: none;
}

.chat-sidebar {
  border-right: 1px solid #d9d3c6;
  background: #fffcf4;
  display: grid;
  grid-template-rows: auto 1fr auto;
  min-height: 0;
  height: 100dvh;
  overflow: hidden;
}

.sidebar-top {
  padding: 1rem;
  border-bottom: 1px solid #e6dfd0;
}

.sidebar-title-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.65rem;
}

.brand-btn {
  margin: 0;
  border: 0;
  padding: 0;
  background: transparent;
  color: #182330;
  font-size: 1.3rem;
  font-weight: 800;
  cursor: pointer;
}

.brand-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.sidebar-btn,
.danger-btn {
  width: 100%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  border: 1px solid #bfc6d3;
  background: #ffffff;
  color: #2b3744;
  border-radius: 10px;
  padding: 0.5rem 0.75rem;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 10px;
}

.sidebar-btn:disabled,
.danger-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.sidebar-search {
  margin-top: 0.8rem;
}

.sidebar-search label {
  display: block;
  margin-bottom: 0.35rem;
  font-size: 0.82rem;
  color: #5a6772;
}

.sidebar-search-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 0.35rem;
}

.sidebar-search-row input {
  border: 1px solid #c9c1b1;
  border-radius: 8px;
  padding: 0.45rem 0.55rem;
  font: inherit;
}

.search-results {
  margin-top: 0.6rem;
  max-height: 180px;
  overflow-y: auto;
  display: grid;
  gap: 0.35rem;
}

.search-item {
  border: 1px solid #d8d1c4;
  background: #ffffff;
  border-radius: 8px;
  text-align: left;
  padding: 0.45rem;
  font: inherit;
  cursor: pointer;
}

.search-item div {
  font-size: 0.82rem;
  color: #334455;
}

.search-item span {
  font-size: 0.72rem;
  color: #657383;
}

.sidebar-sessions {
  min-height: 0;
  overflow-y: auto;
  padding: 0.9rem 0.8rem;
}

.sidebar-sessions h2 {
  margin: 0 0 0.55rem;
  font-size: 0.95rem;
}

.sidebar-muted {
  color: #74808d;
  font-size: 0.86rem;
}

.session-item {
  width: 100%;
  text-align: left;
  border: 1px solid #d7d0c2;
  background: #ffffff;
  border-radius: 10px;
  padding: 0.55rem;
  margin-bottom: 0.45rem;
  cursor: pointer;
  font: inherit;
}

.session-item strong {
  display: block;
  font-size: 0.86rem;
}

.session-item p {
  margin: 0.25rem 0;
  font-size: 0.77rem;
  color: #5e6a77;
  line-height: 1.35;
}

.session-item span {
  font-size: 0.72rem;
  color: #6f7c88;
}

.session-item.active {
  border-color: #2f5abf;
  background: #f4f8ff;
}

.sidebar-bottom {
  border-top: 1px solid #e4ddcf;
  padding: 0.8rem;
}

.danger-btn {
  border-color: #e2b3aa;
  color: #9e2710;
  background: #fff6f4;
}

.chat-main {
  height: 100dvh;
  min-height: 0;
  display: grid;
  grid-template-rows: auto minmax(0, 1fr) auto auto;
  overflow: hidden;
}

.chat-header {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
  padding: 0.7rem 1.2rem;
  border-bottom: 1px solid #ded8cb;
}

.chat-header h2 {
  margin: 0;
  font-size: 1.3rem;
}

.chat-header p {
  margin: 0.3rem 0 0;
  color: #5a6772;
  font-size: 0.9rem;
}

.chat-header-actions {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.chat-status {
  display: flex;
  flex-wrap: wrap;
  gap: 0.8rem;
  padding: 0.65rem 1.2rem;
  font-size: 0.84rem;
  color: #42515f;
  border-bottom: 1px solid #e6dfd1;
  background: #fbfaf7;
}

.chat-status-spacer {
  visibility: hidden;
}

.chat-log {
  overflow-y: auto;
  min-height: 0;
  padding: 1rem 3rem;
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.empty-state {
  max-width: 850px;
  margin: auto;
  /* padding: 1.2rem;
  border-radius: 14px;
  border: 1px dashed #c8c1b5;
  background: #fffaf0; */
  color: #4f5d6b;
  font-size: 1.3rem;
}

.message {
  max-width: min(900px, 100%);
  border-radius: 14px;
  border: 1px solid #ddd6c8;
  background: #fffef8;
  padding: 0.8rem 1rem;
  box-shadow: 0 2px 5px rgba(40, 45, 55, 0.04);
}

.message.user {
  align-self: flex-end;
  background: #f4f9ff;
  border-color: #b8d4ef;
}

.message.assistant {
  align-self: flex-start;
}

.message-body p {
  margin: 0.42rem 0;
}

.message-body table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.6rem;
  font-size: 0.9rem;
}

.message-body th,
.message-body td {
  border: 1px solid #d6deea;
  padding: 0.4rem;
  text-align: left;
}

.message-references {
  margin-top: 0.75rem;
  border-top: 1px solid #e4ddcf;
  padding-top: 0.6rem;
  font-size: 0.85rem;
  display: grid;
  gap: 0.35rem;
}

.reference-item {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  width: fit-content;
  border: 1px solid #d6deea;
  background: #fbf8ef;
  padding: 0.35rem 0.55rem;
  border-radius: 8px;
  cursor: pointer;
  font: inherit;
}

.message-confidence {
  margin-top: 0.5rem;
  font-size: 0.8rem;
  color: #5b6772;
}

.thinking-indicator {
  color: #41515f;
  font-size: 0.88rem;
}

.thinking-indicator-dots {
  display: inline-block;
  min-width: 1.8em;
}

.chat-error {
  padding: 0.55rem 1.2rem;
  color: #c3391a;
  font-size: 0.88rem;
}

.chat-input {
  /* border-top: 1px solid #ddd6ca; */
  padding: 0rem 3rem 2rem;
  background: transparent;
}

.chat-input-shell {
  border: 1px solid #d8d2c6;
  border-radius: 25px;
  background: #ffffff;
  box-shadow: 0 8px 18px rgba(40, 45, 55, 0.08);
  padding: 1rem;
  display: grid;
  gap: 0.65rem;
}

.chat-input textarea {
  width: 100%;
  /* border: 1px solid #d8d2c6;
  border-radius: 12px; */
  padding: 0.8rem 0.85rem;
  height: 78px;
  font: inherit;
  color: #22303d;
  font-size: 1.1rem;
  border: none;
  outline: none;
  box-shadow: none;
  resize: none;
}

.chat-input textarea:focus {
  outline: none;
  /* border-color: #2d5ec7; */
  /* box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2); */
  /* box-shadow: 0 0 0 3px rgba(45, 94, 199, 0.14); */
}

.chat-input-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
}

.primary-btn,
.ghost-btn,
.icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  border-radius: 10px;
  border: 1px solid transparent;
  padding: 0.48rem 0.75rem;
  font-weight: 600;
  cursor: pointer;
  font-size: 1rem;
}

.primary-btn {
  background: linear-gradient(135deg, #1f4ec3, #2d6be1);
  color: #ffffff;
  min-width: 84px;
  border-color: #1f4ec3;
}

.primary-btn:disabled {
  background: #8c9fd8;
  cursor: not-allowed;
}

.ghost-btn,
.icon-btn {
  border-color: #bfc6d3;
  background: #f8fafc;
  color: #2b3744;
}

.icon-btn {
  padding: 0.38rem;
}

.ghost-btn:disabled,
.icon-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.reference-panel {
  border-left: 1px solid #d9d3c6;
  background: #ffffff;
  padding: 1rem;
  display: grid;
  grid-template-rows: auto auto 1fr;
  gap: 0.8rem;
}

.reference-panel header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.4rem;
}

.reference-panel h3 {
  margin: 0;
  font-size: 0.95rem;
}

.reference-panel blockquote {
  margin: 0;
  padding: 0.55rem;
  background: #f5f8ff;
  border-radius: 8px;
  border-left: 3px solid #385fcc;
  font-size: 0.86rem;
}

.reference-panel-body {
  font-size: 0.84rem;
  color: #415161;
  overflow-y: auto;
  white-space: pre-wrap;
  line-height: 1.45;
}

.hidden-input {
  display: none;
}

@media (max-width: 1240px) {
  .chat-layout.has-sidebar {
    grid-template-columns: 300px minmax(0, 1fr);
  }

  .chat-layout.has-sidebar.has-reference {
    grid-template-columns: 300px minmax(0, 1fr);
  }

  .reference-panel {
    position: fixed;
    right: 0;
    top: 0;
    bottom: 0;
    width: min(360px, 95vw);
    z-index: 20;
    box-shadow: -8px 0 20px rgba(30, 33, 40, 0.12);
  }
}

@media (max-width: 860px) {
  .chat-layout,
  .chat-layout.has-sidebar,
  .chat-layout.has-reference,
  .chat-layout.has-sidebar.has-reference {
    grid-template-columns: minmax(0, 1fr);
  }

  .chat-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: min(84vw, 340px);
    z-index: 30;
    min-height: auto;
    border-right: 1px solid #d9d3c6;
    border-bottom: 0;
    box-shadow: 8px 0 20px rgba(33, 36, 42, 0.14);
  }

  .sidebar-backdrop {
    position: fixed;
    inset: 0;
    z-index: 25;
    border: 0;
    background: rgba(20, 24, 31, 0.26);
    display: block;
  }

  .chat-input-actions {
    justify-content: space-between;
  }
}
